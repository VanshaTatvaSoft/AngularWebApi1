@switch (config.type) {

  @case ('textarea') {
    <mat-form-field [appearance]="config.appearance" class="w-full" [ngClass]="config.class">
      <mat-label>
        {{ config.label }}
        @if (showRequiredStar) { <span class="required-star">*</span> }
      </mat-label>

      <textarea matInput
        [formControl]="formControl || internalControl"
        [placeholder]="config.placeholder"
        [id]="config.id"
        [rows]="config?.rows || 3"
        [disabled]="config.disabled ?? false"
        (blur)="(formControl || internalControl)?.markAsTouched()"></textarea>

      @if (config.hint) { <mat-hint>{{ config.hint }}</mat-hint> }
      @if (errorMessage) { <mat-error>{{ errorMessage }}</mat-error> }
    </mat-form-field>
  }

  @case ('select') {
    <mat-form-field [appearance]="config.appearance" class="w-full" [ngClass]="config.class">
      <mat-label>
        {{ config.label }}
        @if (showRequiredStar) { <span class="required-star">*</span> }
      </mat-label>

      <mat-select [formControl]="formControl || internalControl"
                  [placeholder]="config.placeholder"
                  [disabled]="config.disabled ?? false"
                  [value]="config.value">
        @for (opt of config.options; track opt.value) {
          <mat-option [value]="opt.value">{{ opt.label }}</mat-option>
        }
      </mat-select>

      @if (config.icon) { <mat-icon matSuffix>{{ config.icon }}</mat-icon> }
      @if (config.hint) { <mat-hint>{{ config.hint }}</mat-hint> }
      @if (errorMessage) { <mat-error>{{ errorMessage }}</mat-error> }
    </mat-form-field>
  }

  @case ('radio') {
    <div class="radio-group" [ngClass]="config.class">
      <label>{{ config.label }}</label>
      <mat-radio-group [formControl]="formControl || internalControl">
        @for (opt of config.options; track opt.value) {
          <mat-radio-button [value]="opt.value">{{ opt.label }}</mat-radio-button>
        }
      </mat-radio-group>
      @if (errorMessage) { <mat-error>{{ errorMessage }}</mat-error> }
    </div>
  }

  @case ('checkbox') {
    <div class="checkbox-group" [ngClass]="config.class">
      <mat-checkbox [formControl]="formControl || internalControl"
                    [disabled]="config.disabled ?? false">
        {{ config.label }}
      </mat-checkbox>
      @if (errorMessage) { <mat-error>{{ errorMessage }}</mat-error> }
    </div>
  }

  @case ('date') {
    <mat-form-field [appearance]="config.appearance" class="w-full" [class]="config.class">
      <mat-label>{{ config.label }}</mat-label>
      <input matInput [matDatepicker]="picker"
        [formControl]="formControl || internalControl"
        [placeholder]="config.placeholder"
        [id]="config.id"
        [disabled]="config.disabled ?? false"
        [min]="config.minDate"
        [max]="config.maxDate"
        (blur)="(formControl || internalControl)?.markAsTouched()"
      >
      <mat-hint>MM/DD/YYYY</mat-hint>
      <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker [startView]="config.startView || 'month'"></mat-datepicker>
      @if (errorMessage) { <mat-error>{{ errorMessage }}</mat-error> }
    </mat-form-field>
  }

  @case ('time picker') {
    <mat-form-field [appearance]="config.appearance" class="w-full" [class]="config.class">
      <mat-label>{{ config.label }}</mat-label>
      <input matInput
        [ngxTimepicker]="timePicker"
        [formControl]="formControl || internalControl"
        [placeholder]="config.placeholder"
        [id]="config.id"
        [disabled]="config.disabled ?? false"
        readonly
        (blur)="(formControl || internalControl)?.markAsTouched()"
      />
      <ngx-material-timepicker #timePicker></ngx-material-timepicker>
      <mat-icon matSuffix class="cursor-pointer" (click)="timePicker.open()">access_time</mat-icon>
      @if (config.hint) { <mat-hint>{{ config.hint }}</mat-hint> }
      @if (errorMessage) { <mat-error>{{ errorMessage }}</mat-error> }
    </mat-form-field>
  }

  @case ('slide toggle') {
    <mat-slide-toggle
      class="w-auto"
      [class]="config.class"
      [formControl]="formControl || internalControl"
      [labelPosition]="config.labelPosition || 'after'"
      [disabled]="config.disabled ?? false">
      {{ config.label }}
      <div>
        @if (errorMessage) { <mat-error>{{ errorMessage }}</mat-error> }
      </div>
    </mat-slide-toggle>
  }

  @case ('file') {
    <div class="file-upload-wrapper" [ngClass]="config.class">
      <label class="file-upload-label" for="{{ config.id || 'file-input' }}">
        {{ config.label }}
        @if (config.showRequiredStar) {
          <span class="required-star">*</span>
        }
      </label>

      <!-- Button to open file selector -->
      <button
        type="button"
        class="file-upload-button"
        [disabled]="config.disabled ?? false"
        (click)="fileInput.click()"
        aria-label="Select files"
      >
        <span class="material-icons">attach_file</span>
        Choose File
      </button>

      <!-- Hidden file input triggered by button -->
      <input
        type="file"
        #fileInput
        style="display:none"
        [attr.accept]="config.accept || '*/*'"
        [disabled]="config.disabled ?? false"
        (change)="onFileSelected($event)"
        (blur)="(formControl || internalControl)?.markAsTouched()"
      />

      <!-- Show previews if any files selected -->
      @if (selectedFiles.length > 0) {
        <div class="file-preview">
          @for (f of selectedFiles; track f.file.name) {
            <div class="preview-item">
              @if (f.preview) {
                <img [src]="f.preview" alt="Preview" />
              } @else {
                <span class="file-icon">{{ getFileExtension(f.file.name) }}</span>
              }
              <span class="file-name">{{ f.file.name }}</span>
              <button
                type="button"
                class="remove-file"
                (click)="removeFile(selectedFiles.indexOf(f))"
                aria-label="Remove file"
              >
                Ã—
              </button>
            </div>
          }
        </div>
      }

      @if (config.hint) {
        <small class="file-hint">{{ config.hint }}</small>
      }

      @if (errorMessage) {
        <div class="error text-danger">{{ errorMessage }}</div>
      }
    </div>
  }

  @default {
    <!-- TEXT, PASSWORD, EMAIL -->
    <mat-form-field [appearance]="config.appearance" class="w-full" [ngClass]="config.class">
      <mat-label>
        {{ config.label }}
        @if (showRequiredStar) { <span class="required-star">*</span> }
      </mat-label>

      <input matInput [type]="isPassword ? (showPassword ? 'text' : 'password') : config.type"
             [formControl]="formControl || internalControl"
             [placeholder]="config.placeholder"
             [id]="config.id"
             [disabled]="config.disabled ?? false"
             [value]="config.value"
             (blur)="(formControl || internalControl)?.markAsTouched()" />

      @if (isPassword) {
        <mat-icon matSuffix class="cursor-pointer" (click)="togglePassword()">
          {{ showPassword ? 'visibility' : 'visibility_off' }}
        </mat-icon>
      }

      @if (!isPassword && config.icon) { <mat-icon matSuffix>{{ config.icon }}</mat-icon> }
      @if (config.hint) { <mat-hint>{{ config.hint }}</mat-hint> }
      @if (errorMessage) { <mat-error>{{ errorMessage }}</mat-error> }
    </mat-form-field>
  }
}
